<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.bohai.subAccount.dao.PositionsDetailMapper" >
  <resultMap id="BaseResultMap" type="com.bohai.subAccount.entity.PositionsDetail" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Jun 04 12:42:18 CST 2017.
    -->
    <result column="SUBUSERID" property="subuserid" jdbcType="VARCHAR" />
    <result column="COMBOKEY" property="combokey" jdbcType="VARCHAR" />
    <result column="INSTRUMENTID" property="instrumentid" jdbcType="VARCHAR" />
    <result column="DIRECTION" property="direction" jdbcType="VARCHAR" />
    <result column="VOLUME" property="volume" jdbcType="DECIMAL" />
  </resultMap>
  <insert id="insert" parameterType="com.bohai.subAccount.entity.PositionsDetail" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Jun 04 12:42:18 CST 2017.
    -->
    insert into T_POSITIONS_DETAIL (SUBUSERID, COMBOKEY, INSTRUMENTID, 
      DIRECTION, VOLUME)
    values (#{subuserid,jdbcType=VARCHAR}, #{combokey,jdbcType=VARCHAR}, #{instrumentid,jdbcType=VARCHAR}, 
      #{direction,jdbcType=VARCHAR}, #{volume,jdbcType=DECIMAL})
  </insert>
  <insert id="insertSelective" parameterType="com.bohai.subAccount.entity.PositionsDetail" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Jun 04 12:42:18 CST 2017.
    -->
    insert into T_POSITIONS_DETAIL
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="subuserid != null" >
        SUBUSERID,
      </if>
      <if test="combokey != null" >
        COMBOKEY,
      </if>
      <if test="instrumentid != null" >
        INSTRUMENTID,
      </if>
      <if test="direction != null" >
        DIRECTION,
      </if>
      <if test="volume != null" >
        VOLUME,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="subuserid != null" >
        #{subuserid,jdbcType=VARCHAR},
      </if>
      <if test="combokey != null" >
        #{combokey,jdbcType=VARCHAR},
      </if>
      <if test="instrumentid != null" >
        #{instrumentid,jdbcType=VARCHAR},
      </if>
      <if test="direction != null" >
        #{direction,jdbcType=VARCHAR},
      </if>
      <if test="volume != null" >
        #{volume,jdbcType=DECIMAL},
      </if>
    </trim>
  </insert>
  
  <select id="findPositionsDetail" resultMap="BaseResultMap" parameterType="java.lang.String">
  	select * from T_POSITIONS_DETAIL
    where SUBUSERID = #{0,jdbcType=VARCHAR} 
    and INSTRUMENTID = #{2,jdbcType=VARCHAR} 
    and DIRECTION = #{1,jdbcType=VARCHAR} 
    and VOLUME &gt; 0
    order by COMBOKEY asc 
  </select>
  
  <select id="getPositionsForUser" resultMap="BaseResultMap" parameterType="java.lang.String">
  	select * from T_POSITIONS_DETAIL
    where SUBUSERID = #{0,jdbcType=VARCHAR} 
    and VOLUME &gt; 0
    order by COMBOKEY asc 
  </select>
  
  <update id="updatePositionsDetail" parameterType="com.bohai.subAccount.entity.PositionsDetail" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jan 18 12:54:24 CST 2017.
    -->
    update T_POSITIONS_DETAIL set VOLUME = #{volume,jdbcType=DECIMAL}
    where SUBUSERID = #{subuserid,jdbcType=VARCHAR} 
    and COMBOKEY = #{combokey,jdbcType=VARCHAR} 
    
  </update>
  
  <delete id="deleteAll">
  	delete from T_POSITIONS_DETAIL
  </delete>
  
  <insert id="insertTodayPositions">
  	insert into T_POSITIONS_DETAIL( SUBUSERID,COMBOKEY,INSTRUMENTID,DIRECTION,VOLUME )
	select SUBUSERID,COMBOKEY,INSTRUMENTID,DIRECTION,nvl(VOLUME,0) - nvl(SELLVOLUME,0) from T_BUY_DETAIL where nvl(VOLUME,0) != nvl(SELLVOLUME,0) 
  
  </insert>
</mapper>